// ==UserScript==
// @name         simkl timing
// @namespace    https://github.com/energistix
// @version      1.8
// @description  Change the timing formating on simkl.com
// @author       You
// @match        https://simkl.com/**
// @icon         https://simkl.com/favicon.ico
// @grant        GM_registerMenuCommand
// @updateURL    https://github.com/energistix/timeToDelay/raw/refs/heads/master/script.user.js
// @downloadURL  https://github.com/energistix/timeToDelay/raw/refs/heads/master/script.user.js
// ==/UserScript==

var V=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var $;if(typeof TextEncoder<"u")$={Encoder:TextEncoder,Decoder:TextDecoder};else try{let r=V("util");$={Encoder:r.TextEncoder,Decoder:r.TextDecoder}}catch{throw new Error("Arcsecond requires TextEncoder and TextDecoder to be polyfilled.")}var A=new $.Encoder,U=new $.Decoder,L=(r,e,t)=>{let o=Uint8Array.from({length:e},(n,s)=>t.getUint8(r+s));return U.decode(o)},b=(r,e)=>{let t=e.getUint8(r);if((t&128)>>7){if((t&224)>>5===6)return 2;if((t&240)>>4===14)return 3;if((t&240)>>4===15)return 4}else return 1;return 1},P=(r,e,t)=>{let o=Uint8Array.from({length:e},(i,n)=>t.getUint8(r+n));return U.decode(o)},v=r=>{let e,t=0,o=0;for(;o<r.length;){for(e=r.codePointAt(o);e;)e=e>>8,o++;t++}return t},O=r=>r instanceof Uint8Array||r instanceof Uint8ClampedArray||r instanceof Int8Array||r instanceof Uint16Array||r instanceof Int16Array||r instanceof Uint32Array||r instanceof Int32Array||r instanceof Float32Array||r instanceof Float64Array,g;(function(r){r.STRING="string",r.ARRAY_BUFFER="arrayBuffer",r.TYPED_ARRAY="typedArray",r.DATA_VIEW="dataView"})(g||(g={}));var D=(r,e=null)=>{let t,o;if(typeof r=="string"){let i=A.encode(r);t=new DataView(i.buffer),o=g.STRING}else if(r instanceof ArrayBuffer)t=new DataView(r),o=g.ARRAY_BUFFER;else if(O(r))t=new DataView(r.buffer),o=g.TYPED_ARRAY;else if(r instanceof DataView)t=r,o=g.DATA_VIEW;else throw new Error(`Cannot process input. Must be a string, ArrayBuffer, TypedArray, or DataView. but got ${typeof r}`);return{dataView:t,inputType:o,isError:!1,error:null,result:null,data:e,index:0}},f=(r,e)=>({...r,isError:!0,error:e}),p=(r,e)=>({...r,result:e}),R=(r,e)=>({...r,data:e}),w=(r,e,t)=>({...r,result:e,index:t}),u=class r{constructor(e){this.p=e}run(e){let t=D(e),o=this.p(t);return o.isError?{isError:!0,error:o.error,index:o.index,data:o.data}:{isError:!1,result:o.result,index:o.index,data:o.data}}fork(e,t,o){let i=D(e),n=this.p(i);return n.isError?t(n.error,n):o(n.result,n)}map(e){let t=this.p;return new r(function(i){let n=t(i);return n.isError?n:p(n,e(n.result))})}chain(e){let t=this.p;return new r(function(i){let n=t(i);return n.isError?n:e(n.result).p(n)})}ap(e){let t=this.p;return new r(function(i){if(i.isError)return i;let n=t(i);if(n.isError)return n;let s=e.p(n);return s.isError?s:p(s,s.result(n.result))})}errorMap(e){let t=this.p;return new r(function(i){let n=t(i);return n.isError?f(n,e({isError:!0,error:n.error,index:n.index,data:n.data})):n})}errorChain(e){let t=this.p;return new r(function(i){let n=t(i);if(n.isError){let{error:s,index:c,data:l}=n;return e({isError:!0,error:s,index:c,data:l}).p({...n,isError:!1})}return n})}mapFromData(e){let t=this.p;return new r(o=>{let i=t(o);return i.isError&&i.error?i:p(i,e({isError:!1,result:i.result,data:i.data,index:i.index}))})}chainFromData(e){let t=this.p;return new r(function(i){let n=t(i);return n.isError&&n.error?n:e({result:n.result,data:n.data}).p(n)})}mapData(e){let t=this.p;return new r(function(i){let n=t(i);return R(n,e(n.data))})}static of(e){return new r(t=>p(t,e))}},B=/[0-9]/,C=/^[0-9]+/,W=/[a-zA-Z]/,F=/^[a-zA-Z]+/,q=/^\s+/,H=/ParseError.+Expecting/,rr=new u(function(e){return e.isError?e:p(e,e.data)});var er=u.of;function d(r){if(typeof r!="number"||r<=0)throw new TypeError(`exactly must be called with a number > 0, but got ${r}`);return function(t){return new u(function(i){if(i.isError)return i;let n=[],s=i;for(let c=0;c<r;c++){let l=t.p(s);if(l.isError)return l;s=l,n.push(s.result)}return p(s,n)}).errorMap(({index:o,error:i})=>`ParseError (position ${o}): Expecting ${r}${i.replace(H,"")}`)}}var tr=new u(function(e){if(e.isError)return e;let{index:t,dataView:o}=e;if(t<o.byteLength){let i=b(t,o);if(t+i<=o.byteLength){let n=P(t,i,o);return w(e,n,t+i)}}return f(e,`ParseError (position ${t}): Expecting a character, but got end of input.`)}),nr=new u(function(e){if(e.isError)return e;let{index:t,dataView:o}=e;return t<o.byteLength?w(e,o.getUint8(t),t):f(e,`ParseError (position ${t}): Unexpected end of input.`)});function a(r){if(!r||v(r)<1)throw new TypeError(`str must be called with a string with length > 1, but got ${r}`);let e=A.encode(r);return new u(function(o){let{index:i,dataView:n}=o;if(n.byteLength-i<e.byteLength)return f(o,`ParseError (position ${i}): Expecting string '${r}', but got end of input.`);let c=L(i,e.byteLength,n);return r===c?w(o,r,i+A.encode(r).byteLength):f(o,`ParseError (position ${i}): Expecting string '${r}', got '${c}...'`)})}function S(r){let e=Object.prototype.toString.call(r);if(e!=="[object RegExp]")throw new TypeError(`regex must be called with a Regular Expression, but got ${e}`);if(r.toString()[1]!=="^")throw new Error("regex parsers must contain '^' start assertion.");return new u(function(o){if(o.isError)return o;let{dataView:i,index:n}=o,s=L(n,i.byteLength-n,i);if(s.length>=1){let c=s.match(r);return c?w(o,c[0],n+A.encode(c[0]).byteLength):f(o,`ParseError (position ${n}): Expecting string matching '${r}', got '${s.slice(0,5)}...'`)}return f(o,`ParseError (position ${n}): Expecting string matching '${r}', but got end of input.`)})}var h=new u(function(e){if(e.isError)return e;let{dataView:t,index:o}=e;if(t.byteLength>o){let i=b(o,t);if(o+i<=t.byteLength){let n=P(o,i,t);return t.byteLength&&n&&B.test(n)?w(e,n,o+i):f(e,`ParseError (position ${o}): Expecting digit, got '${n}'`)}}return f(e,`ParseError (position ${o}): Expecting digit, but got end of input.`)}),or=S(C).errorMap(({index:r})=>`ParseError (position ${r}): Expecting digits`),ir=new u(function(e){if(e.isError)return e;let{index:t,dataView:o}=e;if(o.byteLength>t){let i=b(t,o);if(t+i<=o.byteLength){let n=P(t,i,o);return o.byteLength&&n&&W.test(n)?w(e,n,t+i):f(e,`ParseError (position ${t}): Expecting letter, got '${n}'`)}}return f(e,`ParseError (position ${t}): Expecting letter, but got end of input.`)}),sr=S(F).errorMap(({index:r})=>`ParseError (position ${r}): Expecting letters`);function x(r){return new u(function(t){if(t.isError)return t;let o=r.length,i=new Array(o),n=t;for(let s=0;s<o;s++){let c=r[s].p(n);if(c.isError)return c;n=c,i[s]=c.result}return p(n,i)})}function E(r){if(r.length===0)throw new Error("List of parsers can't be empty.");return new u(function(t){if(t.isError)return t;let o=null;for(let i of r){let n=i.p(t);if(!n.isError)return n;(o===null||o&&n.index>o.index)&&(o=n)}return o})}function Y(r){return new u(function(t){if(t.isError)return t;let o=r.p(t);return o.isError?p(t,null):o})}var ar=new u(function(e){if(e.isError)return e;let{index:t}=e;return t>0?f(e,`ParseError 'startOfInput' (position ${t}): Expected start of input'`):e}),cr=new u(function(e){if(e.isError)return e;let{dataView:t,index:o,inputType:i}=e;if(o!==t.byteLength){let n=i===g.STRING?String.fromCharCode(t.getUint8(o)):`0x${t.getUint8(o).toString(16).padStart(2,"0")}`;return f(e,`ParseError 'endOfInput' (position ${o}): Expected end of input but got '${n}'`)}return p(e,null)}),N=S(q).errorMap(({index:r})=>`ParseError 'many1' (position ${r}): Expecting to match at least one value`),ur=Y(N).map(r=>r||"");var m=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function T(r,e,t,o){let i=new Date,n=new Date;if(r==="Tomorrow")n.setDate(n.getDate()+1);else if(r!=="Today"){let s=i.getDay(),c=m.indexOf(r);if(c===-1)throw new Error("Invalid day provided");let l=c-s;l<=0&&(l+=7),n.setDate(n.getDate()+l)}return n.setHours(e),n.setMinutes(t),o==="PM"&&n.getHours()<12&&n.setHours(n.getHours()+12),n}var y=r=>Number(r.join("")),G=x([E([a("Today"),a("Tomorrow"),...m.map(r=>a(r))]),a(", "),d(2)(h).map(y),a(":"),d(2)(h).map(y),a(" "),E([a("AM"),a("PM")])]).map(([r,,e,,t,,o])=>T(r,e,t,o)),z=x([a("Next"),a(" "),E(m.map(a))]).map(([,,r])=>{let t=new Date().getDay(),o=m.indexOf(r),i=T(r,0,0,"PM");return o>t&&i.setDate(i.getDate()+7),i}),_=x([E(m.map(r=>a(r.slice(0,3)))),a(" "),d(2)(h).map(y),a("-"),d(2)(h).map(y),a("-"),d(4)(h).map(y)]).map(([,,r,,e,,t])=>new Date(t,e-1,r)),Q=x([a("Airing, "),d(2)(h).map(y),a(":"),d(2)(h).map(y),a(" "),E([a("AM"),a("PM")])]).map(([,r,,e,,t])=>T("Today",r,e,t)),Z=E([G,z,_,Q]);function k(r){let e=Z.run(r);if(e.isError)throw new Error(e.error);return e.result}function I(r){let e=new Date;if(r.getTime()<e.getTime())return"Any moment now";let t=(r.getMinutes()-e.getMinutes()+60)%24,o=(r.getHours()-e.getHours()+24)%24,i=r.getDate()-e.getDate()+(r.getMonth()-e.getMonth())*30+(r.getFullYear()-e.getFullYear())*365,n=Math.floor(i/7);return n>1?`In ${n} weeks`:i>1?`In ${i} days`:i===1?"Tomorrow":o>0?`In ${o} hours`:t>0?`In ${t} minutes`:"Any moment now"}var M={key:"search_url",defaultUrl:"https://google.com/search?q=%s",get searchUrl(){return localStorage.getItem(this.key)??this.defaultUrl},set searchUrl(r){localStorage.setItem(this.key,r)},promptForSearchUrl(){let r=prompt("Enter search URL (use %s where the search term should go):",this.searchUrl);r&&(this.searchUrl=r,alert("Search URL updated."),location.reload())}};GM_registerMenuCommand("Set search URL",function(){M.promptForSearchUrl()});function J(){document.querySelectorAll(".SimklTVProfilePosterEpisodeText").forEach(o=>{try{let i=null;o.dataset.date&&(i=new Date(o.dataset.date)),i===null&&(i=k(o.innerText),o.dataset.date=i.toISOString());let n=I(i);o.innerText=n}catch{}});let e=document.querySelector(".SimklTVAboutBlock .SimklTVAboutTitleText h1.headDetail"),t=document.querySelector(".SimklTVAboutBlock .SimklTVAboutTitleText h2.headDetail");if(t){let o=(t.innerText||e?.innerText)??"",i=M.searchUrl.replace("%s",o),n=document.createElement("a");n.href=i;let s=i.match(/https?:\/\/([^/]+)/)?.[1]??"unknown";n.target="_blank",n.rel="noopener noreferrer",n.className="simkl-search-link",n.style.color="white",n.style.fontSize="1.2em",n.style.textWrap="auto",n.innerText=`Search on ${s} for "${o}"`,t.replaceWith(n)}}setInterval(J,1e3);

