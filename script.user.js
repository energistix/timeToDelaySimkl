// ==UserScript==
// @name         simkl timing
// @namespace    https://github.com/energistix
// @version      1.9
// @description  Change the timing formating on simkl.com
// @author       You
// @match        https://simkl.com/**
// @icon         https://simkl.com/favicon.ico
// @grant        GM_registerMenuCommand
// @updateURL    https://github.com/energistix/timeToDelay/raw/refs/heads/master/script.user.js
// @downloadURL  https://github.com/energistix/timeToDelay/raw/refs/heads/master/script.user.js
// ==/UserScript==

var V=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var $;if(typeof TextEncoder<"u")$={Encoder:TextEncoder,Decoder:TextDecoder};else try{let r=V("util");$={Encoder:r.TextEncoder,Decoder:r.TextDecoder}}catch{throw new Error("Arcsecond requires TextEncoder and TextDecoder to be polyfilled.")}var A=new $.Encoder,U=new $.Decoder,L=(r,e,t)=>{let n=Uint8Array.from({length:e},(o,s)=>t.getUint8(r+s));return U.decode(n)},b=(r,e)=>{let t=e.getUint8(r);if((t&128)>>7){if((t&224)>>5===6)return 2;if((t&240)>>4===14)return 3;if((t&240)>>4===15)return 4}else return 1;return 1},P=(r,e,t)=>{let n=Uint8Array.from({length:e},(i,o)=>t.getUint8(r+o));return U.decode(n)},v=r=>{let e,t=0,n=0;for(;n<r.length;){for(e=r.codePointAt(n);e;)e=e>>8,n++;t++}return t},O=r=>r instanceof Uint8Array||r instanceof Uint8ClampedArray||r instanceof Int8Array||r instanceof Uint16Array||r instanceof Int16Array||r instanceof Uint32Array||r instanceof Int32Array||r instanceof Float32Array||r instanceof Float64Array,g;(function(r){r.STRING="string",r.ARRAY_BUFFER="arrayBuffer",r.TYPED_ARRAY="typedArray",r.DATA_VIEW="dataView"})(g||(g={}));var D=(r,e=null)=>{let t,n;if(typeof r=="string"){let i=A.encode(r);t=new DataView(i.buffer),n=g.STRING}else if(r instanceof ArrayBuffer)t=new DataView(r),n=g.ARRAY_BUFFER;else if(O(r))t=new DataView(r.buffer),n=g.TYPED_ARRAY;else if(r instanceof DataView)t=r,n=g.DATA_VIEW;else throw new Error(`Cannot process input. Must be a string, ArrayBuffer, TypedArray, or DataView. but got ${typeof r}`);return{dataView:t,inputType:n,isError:!1,error:null,result:null,data:e,index:0}},f=(r,e)=>({...r,isError:!0,error:e}),p=(r,e)=>({...r,result:e}),R=(r,e)=>({...r,data:e}),w=(r,e,t)=>({...r,result:e,index:t}),u=class r{constructor(e){this.p=e}run(e){let t=D(e),n=this.p(t);return n.isError?{isError:!0,error:n.error,index:n.index,data:n.data}:{isError:!1,result:n.result,index:n.index,data:n.data}}fork(e,t,n){let i=D(e),o=this.p(i);return o.isError?t(o.error,o):n(o.result,o)}map(e){let t=this.p;return new r(function(i){let o=t(i);return o.isError?o:p(o,e(o.result))})}chain(e){let t=this.p;return new r(function(i){let o=t(i);return o.isError?o:e(o.result).p(o)})}ap(e){let t=this.p;return new r(function(i){if(i.isError)return i;let o=t(i);if(o.isError)return o;let s=e.p(o);return s.isError?s:p(s,s.result(o.result))})}errorMap(e){let t=this.p;return new r(function(i){let o=t(i);return o.isError?f(o,e({isError:!0,error:o.error,index:o.index,data:o.data})):o})}errorChain(e){let t=this.p;return new r(function(i){let o=t(i);if(o.isError){let{error:s,index:c,data:l}=o;return e({isError:!0,error:s,index:c,data:l}).p({...o,isError:!1})}return o})}mapFromData(e){let t=this.p;return new r(n=>{let i=t(n);return i.isError&&i.error?i:p(i,e({isError:!1,result:i.result,data:i.data,index:i.index}))})}chainFromData(e){let t=this.p;return new r(function(i){let o=t(i);return o.isError&&o.error?o:e({result:o.result,data:o.data}).p(o)})}mapData(e){let t=this.p;return new r(function(i){let o=t(i);return R(o,e(o.data))})}static of(e){return new r(t=>p(t,e))}},B=/[0-9]/,C=/^[0-9]+/,W=/[a-zA-Z]/,F=/^[a-zA-Z]+/,q=/^\s+/,H=/ParseError.+Expecting/,rr=new u(function(e){return e.isError?e:p(e,e.data)});var er=u.of;function d(r){if(typeof r!="number"||r<=0)throw new TypeError(`exactly must be called with a number > 0, but got ${r}`);return function(t){return new u(function(i){if(i.isError)return i;let o=[],s=i;for(let c=0;c<r;c++){let l=t.p(s);if(l.isError)return l;s=l,o.push(s.result)}return p(s,o)}).errorMap(({index:n,error:i})=>`ParseError (position ${n}): Expecting ${r}${i.replace(H,"")}`)}}var tr=new u(function(e){if(e.isError)return e;let{index:t,dataView:n}=e;if(t<n.byteLength){let i=b(t,n);if(t+i<=n.byteLength){let o=P(t,i,n);return w(e,o,t+i)}}return f(e,`ParseError (position ${t}): Expecting a character, but got end of input.`)}),nr=new u(function(e){if(e.isError)return e;let{index:t,dataView:n}=e;return t<n.byteLength?w(e,n.getUint8(t),t):f(e,`ParseError (position ${t}): Unexpected end of input.`)});function a(r){if(!r||v(r)<1)throw new TypeError(`str must be called with a string with length > 1, but got ${r}`);let e=A.encode(r);return new u(function(n){let{index:i,dataView:o}=n;if(o.byteLength-i<e.byteLength)return f(n,`ParseError (position ${i}): Expecting string '${r}', but got end of input.`);let c=L(i,e.byteLength,o);return r===c?w(n,r,i+A.encode(r).byteLength):f(n,`ParseError (position ${i}): Expecting string '${r}', got '${c}...'`)})}function S(r){let e=Object.prototype.toString.call(r);if(e!=="[object RegExp]")throw new TypeError(`regex must be called with a Regular Expression, but got ${e}`);if(r.toString()[1]!=="^")throw new Error("regex parsers must contain '^' start assertion.");return new u(function(n){if(n.isError)return n;let{dataView:i,index:o}=n,s=L(o,i.byteLength-o,i);if(s.length>=1){let c=s.match(r);return c?w(n,c[0],o+A.encode(c[0]).byteLength):f(n,`ParseError (position ${o}): Expecting string matching '${r}', got '${s.slice(0,5)}...'`)}return f(n,`ParseError (position ${o}): Expecting string matching '${r}', but got end of input.`)})}var h=new u(function(e){if(e.isError)return e;let{dataView:t,index:n}=e;if(t.byteLength>n){let i=b(n,t);if(n+i<=t.byteLength){let o=P(n,i,t);return t.byteLength&&o&&B.test(o)?w(e,o,n+i):f(e,`ParseError (position ${n}): Expecting digit, got '${o}'`)}}return f(e,`ParseError (position ${n}): Expecting digit, but got end of input.`)}),or=S(C).errorMap(({index:r})=>`ParseError (position ${r}): Expecting digits`),ir=new u(function(e){if(e.isError)return e;let{index:t,dataView:n}=e;if(n.byteLength>t){let i=b(t,n);if(t+i<=n.byteLength){let o=P(t,i,n);return n.byteLength&&o&&W.test(o)?w(e,o,t+i):f(e,`ParseError (position ${t}): Expecting letter, got '${o}'`)}}return f(e,`ParseError (position ${t}): Expecting letter, but got end of input.`)}),sr=S(F).errorMap(({index:r})=>`ParseError (position ${r}): Expecting letters`);function x(r){return new u(function(t){if(t.isError)return t;let n=r.length,i=new Array(n),o=t;for(let s=0;s<n;s++){let c=r[s].p(o);if(c.isError)return c;o=c,i[s]=c.result}return p(o,i)})}function E(r){if(r.length===0)throw new Error("List of parsers can't be empty.");return new u(function(t){if(t.isError)return t;let n=null;for(let i of r){let o=i.p(t);if(!o.isError)return o;(n===null||n&&o.index>n.index)&&(n=o)}return n})}function Y(r){return new u(function(t){if(t.isError)return t;let n=r.p(t);return n.isError?p(t,null):n})}var ar=new u(function(e){if(e.isError)return e;let{index:t}=e;return t>0?f(e,`ParseError 'startOfInput' (position ${t}): Expected start of input'`):e}),cr=new u(function(e){if(e.isError)return e;let{dataView:t,index:n,inputType:i}=e;if(n!==t.byteLength){let o=i===g.STRING?String.fromCharCode(t.getUint8(n)):`0x${t.getUint8(n).toString(16).padStart(2,"0")}`;return f(e,`ParseError 'endOfInput' (position ${n}): Expected end of input but got '${o}'`)}return p(e,null)}),N=S(q).errorMap(({index:r})=>`ParseError 'many1' (position ${r}): Expecting to match at least one value`),ur=Y(N).map(r=>r||"");var m=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function T(r,e,t,n){let i=new Date,o=new Date;if(r==="Tomorrow")o.setDate(o.getDate()+1);else if(r!=="Today"){let s=i.getDay(),c=m.indexOf(r);if(c===-1)throw new Error("Invalid day provided");let l=c-s;l<=0&&(l+=7),o.setDate(o.getDate()+l)}return o.setHours(e),o.setMinutes(t),n==="PM"&&o.getHours()<12&&o.setHours(o.getHours()+12),o}var y=r=>Number(r.join("")),G=x([E([a("Today"),a("Tomorrow"),...m.map(r=>a(r))]),a(", "),d(2)(h).map(y),a(":"),d(2)(h).map(y),a(" "),E([a("AM"),a("PM")])]).map(([r,,e,,t,,n])=>T(r,e,t,n)),z=x([a("Next"),a(" "),E(m.map(a))]).map(([,,r])=>{let t=new Date().getDay(),n=m.indexOf(r),i=T(r,0,0,"PM");return n>t&&i.setDate(i.getDate()+7),i}),_=x([E(m.map(r=>a(r.slice(0,3)))),a(" "),d(2)(h).map(y),a("-"),d(2)(h).map(y),a("-"),d(4)(h).map(y)]).map(([,,r,,e,,t])=>new Date(t,e-1,r)),Q=x([a("Airing, "),d(2)(h).map(y),a(":"),d(2)(h).map(y),a(" "),E([a("AM"),a("PM")])]).map(([,r,,e,,t])=>T("Today",r,e,t)),Z=E([G,z,_,Q]);function k(r){let e=Z.run(r);if(e.isError)throw new Error(e.error);return e.result}function I(r){let e=new Date;if(r.getTime()<e.getTime())return"Any moment now";let t=(r.getMinutes()-e.getMinutes()+60)%24,n=(r.getHours()-e.getHours()+24)%24,i=r.getDate()-e.getDate()+(r.getMonth()-e.getMonth())*30+(r.getFullYear()-e.getFullYear())*365,o=Math.floor(i/7);return o>1?`In ${o} weeks`:i>1?`In ${i} days`:i===1?"Tomorrow":n>0?`In ${n} hours`:t>0?`In ${t} minutes`:"Any moment now"}var M={key:"search_url",defaultUrl:"https://google.com/search?q=%s",get searchUrl(){return localStorage.getItem(this.key)??this.defaultUrl},set searchUrl(r){localStorage.setItem(this.key,r)},promptForSearchUrl(){let r=prompt("Enter search URL (use %s where the search term should go):",this.searchUrl);r&&(this.searchUrl=r,alert("Search URL updated."),location.reload())}};GM_registerMenuCommand("Set search URL",function(){M.promptForSearchUrl()});function J(){document.querySelectorAll(".SimklTVProfilePosterEpisodeText").forEach(n=>{try{let i=null;n.dataset.date&&(i=new Date(n.dataset.date)),i===null&&(i=k(n.innerText),n.dataset.date=i.toISOString());let o=I(i);n.innerText=o}catch{}});let e=document.querySelector(".SimklTVAboutBlock .SimklTVAboutTitleText h1.headDetail"),t=document.querySelector(".SimklTVAboutBlock .SimklTVAboutTitleText h2.headDetail");if(t){let n=(t.innerText||e?.innerText)??"";n.match(/season [0-9]+ season [0-9]+/i)&&(n=n.replace(/(season [0-9]+) season [0-9]+/i,"$1"));let i=M.searchUrl.replace("%s",n),o=document.createElement("a");o.href=i;let s=i.match(/https?:\/\/([^/]+)/)?.[1]??"unknown";o.target="_blank",o.rel="noopener noreferrer",o.className="simkl-search-link",o.style.color="white",o.style.fontSize="1.2em",o.style.textWrap="auto",o.innerText=`Search on ${s} for "${n}"`,t.replaceWith(o)}}setInterval(J,1e3);

